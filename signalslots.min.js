function Set(a,b){a.length=0,b.forEach(function(b){a.push(b)},this)}function RemoveObjectsInIndexArray(a,b){var c=new Array,d=a.filter(function(a,d){return-1!=b.indexOf(d)?(c.push(a),!1):!0},this);return Set(a,d),c}function RemoveObjectByFilter(a,b,c){if(a)for(var d=0;d<a.length;++d){var e=a[d];if(b.call(c,e,d))return a.splice(d,1),e}return null}function QueryObject(a,b){if(a)for(var c=0,d=a.length;d>c;++c){var e=a[c];if(b(e,c))return e}return null}function Foreach(a,b){for(var c in a)b(a[c],c)}var Ss={};window.Ss=Ss;var SlotTunnel=function(){function a(){}return a}();Ss.SlotTunnel=SlotTunnel;var Slot=function(){function a(){this.emitedCount=0}return Object.defineProperty(a.prototype,"veto",{get:function(){return this._veto},set:function(a){this._veto=a,this.tunnel&&(this.tunnel.veto=a)},enumerable:!0,configurable:!0}),a.prototype.emit=function(a,b){this.data=a,this.tunnel=b,this.doEmit()},a.prototype.doEmit=function(){this.target?this.cb&&this.cb.call(this.target,this):this.cb&&this.cb.call(this,this),this.data=void 0,this.tunnel=void 0,++this.emitedCount},a.Data=function(b){var c=new a;return c.data=b,c},a}();Ss.Slot=Slot;var Slots=function(){function a(){this.slots=new Array}return a.prototype.add=function(a){this.slots.push(a)},a.prototype.emit=function(a,b){var c,d=this;this.slots.concat().forEach(function(e,f){return null!=e.count&&e.emitedCount>=e.count?!0:(e.signal=d.signal,e.sender=d.owner,e.emit(a,b),null!=e.count&&e.emitedCount>=e.count?(null==c&&(c=new Array),c.push(f),!0):!e.veto)},this),c&&RemoveObjectsInIndexArray(this.slots,c)},a.prototype.disconnect=function(a,b){var c=RemoveObjectsByFilter(this.slots,function(c){return a&&c.cb!=a?!1:c.target==b?!0:!1},this);return 0!=c.length},a.prototype.find_connected_function=function(a,b){return QueryObject(this.slots,function(c){return c.cb==a&&c.target==b})},a.prototype.is_connected=function(a){return null!=QueryObject(this.slots,function(b){return b.target==a})},a}();Ss.Slots=Slots;var Signals=function(){function a(){this._slots={}}return a.prototype.register=function(a){return null==a?(console.warn("不能注册一个空信号"),!1):this._slots[a]?!1:(this._slots[a]=null,!0)},a.prototype.avaslots=function(a){var b=this._slots[a];return void 0===b?(console.warn("对象信号 "+a+" 不存在"),null):(null==b&&(b=new Slots,b.signal=a,this._slots[a]=b),b)},a.prototype.once=function(a,b,c){var d=this.connect(a,b,c);return d.count=1,d},a.prototype.connect=function(a,b,c){var d=this.avaslots(a);if(null==d)return console.warn("对象信号 "+a+" 不存在"),null;var e;return(e=d.find_connected_function(b,c))?e:(e=new Slot,e.cb=b,e.target=c,d.add(e),e)},a.prototype.isConnected=function(a){var b=this._slots[a];return null!=b&&0!=b.slots.length},a.prototype.emit=function(a,b,c){var d=this._slots[a];if(d)d.emit(b,c);else if(void 0===d)return void console.warn("对象信号 "+a+" 不存在")},a.prototype.disconnectOfTarget=function(a,b){void 0===b&&(b=!0),null!=a&&Foreach(this._slots,function(b){b&&b.disconnect(null,a)})},a.prototype.disconnect=function(a,b,c){var d=this._slots[a];null!=d&&null==b&&null==c&&(d.slots.length=0)},a}();Ss.Signals=Signals;